compilers:
  ocaml:
    type: s3tarballs
    check_exe: bin/ocaml --version
    targets:
      - 4.04.2
      - 4.06.1
      - 4.07.1
      - 4.07.1-flambda
      - 4.08.1
      - 4.08.1-flambda
      - 4.09.0
      - 4.09.0-flambda
      - 4.09.1
      - 4.09.1-flambda
      - 4.10.0
      - 4.10.0-flambda
      - 4.10.1
      - 4.10.1-flambda
      - 4.10.2
      - 4.10.2-flambda
      - 4.11.1
      - 4.11.1-flambda
      - 4.11.2
      - 4.11.2-flambda
      - 4.12.0
      - 4.12.0-flambda
    newer:
      type: tarballs
      check_exe: bin/ocaml --version
      url: https://caml.inria.fr/pub/distrib/ocaml-{rel}/ocaml-{rel}.{min}.tar.xz
      dir: ocaml-{rel}.{min}
      compression: xz
      after_stage_script:
        - mkdir install
        - cd {dir}
        - ./configure --prefix={destination}/{dir} {options}
        - make
        - make install DESTDIR=$(realpath ../install)
        - cd ..
        - rm -r {dir}
        - mv install/{destination}/{dir} {dir}
        - rm -r install
      targets:
        - name: 4.13.0
          rel: 4.13
          min: 0
          options: ""
        - name: 4.13.0-flambda
          rel: 4.13
          min: 0
          options: --enable-flambda
        - name: 4.13.1
          rel: 4.13
          min: 1
          options: ""
        - name: 4.13.1-flambda
          rel: 4.13
          min: 1
          options: --enable-flambda
        - name: 4.14.0
          rel: 4.14
          min: 0
          options: ""
        - name: 4.14.0-flambda
          rel: 4.14
          min: 0
          options: --enable-flambda
      multicore:
        if: nightly
        targets:
          - name: 5.0.0~alpha0
            rel: 5.0
            min: 0~alpha0
            options: ""
          - name: 5.0.0~alpha0-flambda
            rel: 5.0
            min: 0~alpha0
            options: --enable-flambda
